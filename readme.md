# DBSnapshot

## 背景

当前 DBA 在数据库运维与性能分析中普遍面临以下痛点：

- **传统监控系统能力不足**  
  以指标为主（QPS、TPS、CPU、IO 等），缺乏数据库内部细节数据，无法还原真实执行现场。
- **故障无法复盘**  
  线上故障发生时只能优先恢复业务，事后会话、SQL、锁等待等关键信息已消失，缺乏分析依据。
- **AI 分析缺乏数据支撑**  
  AI 需要高质量、结构化、可回放的数据作为输入，仅有指标无法完成根因推演。

---

## 产品介绍

**DBSnapshot** 是一款面向 DBA 与数据库工程师的 **数据库历史性能快照与回溯分析平台**。  
它以低侵入、只读方式，周期性采集数据库内部性能视图数据，将“瞬时状态”转化为**可回放、可分析、可被 AI 理解的历史数据资产**。

与传统监控系统不同，DBSnapshot 关注的是：

> **问题发生时，数据库内部真实发生了什么。**

而不仅仅是“指标是否异常”。

---

## 核心理念

**把数据库的“现场”保存下来，而不是只保存指标。**

- 指标只能告诉你：慢了、堵了、负载高了
- 快照数据才能回答：
    - 当时有哪些会话在运行？
    - 执行的是什么 SQL？
    - 谁在等谁？
    - 锁、事务、连接的真实状态是什么？

DBSnapshot 的目标是成为数据库的 **“黑匣子 + 取证系统”**。

---

## 产品定位

- ❌ 不是实时告警系统
- ❌ 不替代 Prometheus / Zabbix
- ✅ 用于 **事后分析、问题复盘、因果定位、AI 推演**

> 当问题已经发生，DBSnapshot 让你还能“回到当时”。

---

## 核心能力

### 1. 多数据库支持

- MySQL
- Oracle
- PostgreSQL
- OceanBase（4.0+）

---

### 2. 周期性快照采集

- 采集周期可配置（默认 60 秒）
- 支持多实例并发采集
- 对被监控数据库低侵入、只读权限
- 数据统一存储至 MySQL 元数据库

---

### 3. 采集内容（示例）

- 活动会话（Active Session）
- 连接与线程状态
- SQL 执行信息
- 锁与阻塞关系
- 事务信息
- 等待事件

重点关注：

> **谁在干什么、在等什么、被谁影响**

---

### 4. 历史回放与对比分析

- 按时间点查看数据库快照
- 对比不同时间段数据库内部状态变化
- 辅助定位：
    - 突发慢 SQL
    - 锁风暴
    - 连接耗尽
    - 异常事务

---

### 5. AI 友好设计

- 数据结构化存储（MySQL）
- 快照数据可直接提供给 LLM / AI 系统
- 支持：
    - 根因分析
    - 故障复盘报告生成
    - 性能趋势推演

---

## 典型使用场景

### 📌 生产故障复盘

- 回看故障时间点数据库内部状态
- 精准定位根因，而不是依赖经验猜测

### 📌 慢 SQL 与锁等待分析

- 还原历史锁等待链
- 找到真正的阻塞源头

### 📌 数据库行为与容量分析

- 连接数变化趋势
- 会话行为模式分析

### 📌 AI 自动化分析

- 将快照数据交给 AI
- 自动生成：
    - 故障分析结论
    - 优化建议
    - 风险提示

---
## 适用人群

- DBA / 数据库工程师
- 架构师
- 运维工程师
- 希望引入 AI 分析数据库问题的团队

---

## 总结

> **DBSnapshot 不是为了告诉你“数据库出问题了”，  
> 而是为了在问题发生后，告诉你“问题是怎么发生的”。**
