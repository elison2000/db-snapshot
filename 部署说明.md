## 安装与发布

### 编译

```bash
go build DBSnapshot.go
```

### 发布

拷贝以下内容到发布目录：

- `DBSnapshot`
- `web/` 目录
> 单文件版本web目录已集成到程序包，不是必须的

---

## 配置说明

准备一个 MySQL 数据库用于存储快照元数据，例如：

- `10.0.0.201:3306`
- database：`db_snapshot`

执行 `sql/init.sql` 初始化表结构。

在发布目录创建 `config.ini`：

```ini
# http 端口
http_port = 808

# 采集快照并发数
parallel = 8

# 采集间隔（秒）
interval = 60

# 被监控实例统一账号
monitor_user = "dba_monitor"
monitor_password = "abc123"

[db]
host = "10.0.0.201"
port = 3306
user = "db_snapshot"
password = "abc123"
database = "db_snapshot"
```

---

## 启动与停止

```bash
# 启动
./DBSnapshot &> running.log &

# 停止
kill <pid>
```

---

## 使用说明

访问 Web 页面：

```
http://<server_ip>:808
```

功能说明：

- **监控大盘**：查看数据库实例快照
- **配置管理**：添加 / 删除 / 修改监控实例

---


## 添加监控实例
1. 创建监控用户

#### MySQL

```sql
CREATE USER dba_monitor IDENTIFIED BY 'abc123';  --账号/密码对应配置文件monitor_user/monitor_password
GRANT SELECT, PROCESS, REPLICATION CLIENT ON *.* TO dba_monitor;
```

#### Oracle

```sql
CREATE USER dba_monitor IDENTIFIED BY abc123;   --账号/密码对应配置文件monitor_user/monitor_password
GRANT CONNECT TO dba_monitor;
GRANT SELECT ANY DICTIONARY TO dba_monitor;
```

#### PostgreSQL

```sql
CREATE USER dba_monitor WITH PASSWORD 'abc123'; --账号/密码对应配置文件monitor_user/monitor_password
GRANT pg_monitor TO dba_monitor;
```
2. 添加监控实例
- 登录Web页面，点击 **配置管理**，进入配置页面。
- 点击新增配置 按钮，填写实例信息
- 点击保存 按钮，保存配置。
- 配置成功后，点击 重载配置 按钮，配置立即生效（非必要，每隔10分钟自动重新加载最新的实例列表）。
---


